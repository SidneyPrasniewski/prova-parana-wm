<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sua Jornada na Prova Paran√°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Fonte Inter */
        body {
            font-family: "Inter", sans-serif;
        }
        /* Estilo para a barra de progresso */
        .progress-bar-bg {
            background-color: #e0e0e0;
            border-radius: 0.5rem;
            overflow: hidden;
            height: 1.5rem;
        }
        .progress-bar {
            height: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.875rem;
            font-weight: bold;
            color: white;
            /* ANIMA√á√ÉO DAS BARRAS (AGORA ACIONADA VIA JS) */
            transition: width 0.8s ease-out; /* Dura√ß√£o da anima√ß√£o da barra */
        }
        /* Altura fixa para a lista de alunos e gr√°ficos */
        #student-list {
            max-height: 450px;
            overflow-y: auto;
        }
        #chart-container {
            height: 350px;
        }

        /* Anima√ß√£o "TikTok" (Pulse Zoom) para o Status do Aluno */
        @keyframes pulseZoom {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.15); }
        }
        .animate-pulseZoom {
            animation: pulseZoom 0.5s ease-in-out;
        }
        
        /* Estilos para o Acorde√£o (Painel Dropdown) */
        .details-panel {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-out;
            background-color: #f8fafc; /* bg-gray-50 */
        }
        .details-panel.open {
            max-height: 1000px; /* Altura suficiente para o conte√∫do */
            transition: max-height 0.7s ease-in;
        }
    </style>
</head>
<body class="bg-gray-100 p-4 md:p-8">

    <div class="max-w-7xl mx-auto bg-white shadow-2xl rounded-lg overflow-hidden">
        
        <!-- Cabe√ßalho (COM AJUSTES DE LOGO) --><header class="bg-blue-800 text-white p-6 shadow-md flex justify-between items-center">
            <!-- Container para o T√≠tulo e Subt√≠tulo --><div>
                <h1 class="text-2xl font-bold">Jornada na Prova Paran√° - Disciplina: Pensamento Computacional 1¬∫ Ano Ensino M√©dio.</h1>
                <p class="text-lg text-blue-100 mt-1">Sua evolu√ß√£o entre a 1¬™ e a 2¬™ Edi√ß√£o (1¬∫ Ano Ensino M√©dio)</p>
            </div>
            
            <!-- CONTAINER DAS DUAS LOGOS (REMOVIDO mix-blend-multiply e AUMENTADO TAMANHO) --><div class="flex-shrink-0 ml-6 flex items-center space-x-4">
                
                <!-- Logo 1 (Paran√° Integral) --><img src="logo_parana_integral690x690_0.png" alt="Logo Paran√° Integral" class="h-28 w-auto"> 
                
                <!-- Logo 2 (Col√©gio WM) --><img src="logoWM.png" alt="Logo Col√©gio WM" class="h-28 w-auto">

            </div>
        </header>

        <!-- Se√ß√£o de M√©tricas Principais (KPIs) (INALTERADO) --><section class="bg-white p-6 grid grid-cols-2 md:grid-cols-4 gap-4 border-b border-gray-200">
            <div class="text-center p-4 bg-blue-100 rounded-lg shadow-sm">
                <p class="text-sm font-medium text-blue-800">M√©dia de Acertos (1¬™ Edi√ß√£o)</p>
                <p class="text-3xl font-bold text-blue-900">23.81%</p>
            </div>
            <div class="text-center p-4 bg-green-100 rounded-lg shadow-sm">
                <p class="text-sm font-medium text-green-800">M√©dia de Acertos (2¬™ Edi√ß√£o)</p>
                <p class="text-3xl font-bold text-green-900">60.00%</p>
            </div>
            <div class="text-center p-4 bg-green-100 rounded-lg shadow-sm">
                <p class="text-sm font-medium text-green-800">Evolu√ß√£o da M√©dia (P2 vs P1)</p>
                
                <!-- Wrapper para o Tooltip (Hover) --><div class="relative group inline-block">
                    
                    <!-- Texto do KPI --><p class="text-3xl font-bold text-green-900">+36.19 p.p.</p>
                    
                    <!-- Bot√£o "Explica√ß√£o" (Substituindo o (?) ) --><span class="mt-1 inline-block bg-blue-500 hover:bg-blue-600 text-white text-xs font-bold py-1 px-2 rounded-md cursor-help">
                        Explica√ß√£o
                    </span>

                    <!-- O Tooltip (Explica√ß√£o para leigos) - AJUSTADO PARA ABRIR PARA BAIXO --><div class="absolute top-full left-1/2 -translate-x-1/2 z-10 w-64 p-3
                                bg-gray-800 text-white text-sm text-left rounded-lg shadow-lg
                                opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none
                                mt-2">
                        <strong>O que √© "p.p."?</strong>
                        <p class="mt-1 font-normal">"p.p." (pontos percentuais) mostra a diferen√ßa simples entre duas porcentagens.</p>
                        <p class="mt-2 font-normal">Significa que a m√©dia da turma "andou" 36,19 pontos (de 23,81% para 60,00%). Usamos "p.p." para n√£o confundir com um aumento de 36,19% (que seria um c√°lculo de propor√ß√£o).</p>
                    </div>
                </div>
            </div>
            <div class="text-center p-4 bg-green-100 rounded-lg shadow-sm">
                <p class="text-sm font-medium text-green-800">Alunos que Melhoraram %</p>
                <p class="text-3xl font-bold text-green-900">83.3%</p>
            </div>
        </section>

        <!-- Container Principal (P√ÅGINAS) (INALTERADO) --><main class="p-6 md:p-8">

            <!-- P√ÅGINA 1: In√≠cio (Gr√°ficos) (INALTERADO) --><div id="page-home">
                <section id="visualizacao">
                    <!-- T√çTULO SEM N√öMERO --><h2 class="text-2xl font-semibold text-gray-800 border-b-2 border-blue-400 pb-2 mb-4">O Retrato da Turma (21 na 1¬™ Edi√ß√£o, 20 na 2¬™)</h2>
                    <div class="grid grid-cols-1 md:grid-cols-5 gap-6">
                        
                        <!-- Gr√°fico 1: Distribui√ß√£o de Desempenho (Gr√°fico de Barras/Torre) --><div class="md:col-span-3 bg-blue-50 p-4 rounded-lg shadow-inner">
                            <h3 class="font-bold text-lg text-center mb-4 text-blue-900">Distribui√ß√£o da % de Acertos (1¬™ vs 2¬™ Edi√ß√£o)</h3>
                            <div id="chart-container" class="relative">
                                <canvas id="distribuicaoChart"></canvas>
                            </div>
                        </div>

                        <!-- Gr√°fico 2: Status da Evolu√ß√£o (Gr√°fico de Pizza) --><div class="md:col-span-2 bg-blue-50 p-4 rounded-lg shadow-inner">
                             <h3 class="font-bold text-lg text-center mb-4 text-blue-900">Nossa Jornada</h3>
                             <div id="chart-container" class="relative">
                                <canvas id="evolucaoChart"></canvas>
                            </div>
                        </div>
                    </div>
                </section>
            </div>

            <!-- Menu de Navega√ß√£o (Bot√µes) (INALTERADO) --><nav class="mt-8 border-t border-gray-200 pt-6 flex flex-col md:flex-row justify-center gap-4">
                <button id="btn-conquistas" class="page-button bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg shadow-md transition-all duration-300">
                    üèÜ Conquistas e Reflex√µes
                </button>
                <button id="btn-jornada" class="page-button bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg shadow-md transition-all duration-300">
                    üèÅ O Que Levar Desta Jornada
                </button>
                <button id="btn-evolucao" class="page-button bg-yellow-500 hover:bg-yellow-600 text-blue-900 font-bold py-3 px-6 rounded-lg shadow-md transition-all duration-300">
                    üöÄ Sua Evolu√ß√£o Individual
                </button>
            </nav>

            <!-- P√ÅGINA 2: Conquistas (Oculta por padr√£o) (INALTERADO) --><div id="page-conquistas" class="hidden mt-8">
                <!-- BOT√ÉO VOLTAR (ATUALIZADO) --><button class="btn-voltar mb-4 text-sm font-medium
                               bg-blue-600 text-white hover:bg-blue-700
                               py-2 px-4 rounded-lg shadow-sm transition-colors duration-200">
                    &larr; In√≠cio
                </button>
                <section id="observacoes">
                    <!-- T√çTULO SEM N√öMERO --><h2 class="text-2xl font-semibold text-gray-800 border-b-2 border-blue-400 pb-2 mb-4">Conquistas e Reflex√µes da Turma</h2>
                    
                    <div class="space-y-4 max-w-4xl mx-auto">
                        
                        <div class="bg-green-50 border border-green-200 p-4 rounded-lg shadow-sm">
                            <h3 class="font-bold text-lg text-green-800">A "Virada de Jogo" da Turma!</h3>
                            <p class="text-gray-700">Parab√©ns a todos! A m√©dia de acertos da turma saltou de 23.81% (P1) para 60.00% (P2). Dos 18 alunos que fizeram as duas provas, 83.3% (15 alunos) melhoraram seu percentual. Um resultado fant√°stico!</p>
                        </div>
                        
                        <div class="bg-cyan-50 border border-cyan-200 p-4 rounded-lg shadow-sm">
                            <h3 class="font-bold text-lg text-cyan-800">Superando o Desafio Inicial</h3>
                            <p class="text-gray-700">Na 1¬™ Edi√ß√£o, 9 alunos come√ßaram com 0% de acertos. Na 2¬™ Edi√ß√£o, **todos** eles pontuaram. Quatro deles (Amanda, Leticia, Luis Gustavo e Samuel) deram um salto direto para 66.67% de acertos. Nossas boas-vindas √† Sara e Laysla, que j√° come√ßaram na 2¬™ Edi√ß√£o com √≥timos 66.67%!</p>
                        </div>

                        <div class="bg-cyan-50 border border-cyan-200 p-4 rounded-lg shadow-sm">
                            <h3 class="font-bold text-lg text-cyan-800">O Novo Patamar da Turma</h3>
                            <p class="text-gray-700">A turma que se concentrava em percentuais mais baixos agora se moveu para cima. Na 2¬™ Edi√ß√£o, **70%** da turma (14 de 20 alunos) alcan√ßou o patamar de 66.67% de acertos.</p>
                        </div>

                        <div class="bg-yellow-50 border border-yellow-200 p-4 rounded-lg shadow-sm">
                            <h3 class="font-bold text-lg text-yellow-800">Pontos de Reflex√£o (Queda ou Estagna√ß√£o)</h3>
                            <p class="text-gray-700">Alguns colegas tiveram queda ou mantiveram o percentual de acertos. Isso √© **absolutamente normal** no processo de aprender.</p>
                            <ul class="list-disc list-inside ml-4 text-gray-700">
                                <li>**Let√≠cia Aiko (100% -> 66.67%):** Come√ßou no topo. Manter-se com um √≥timo percentual √© um desafio.</li>
                                <li>**Carlos Eduardo (66.66% -> 33.33%):** J√° mostrou que domina o assunto. Acontece!</li>
                                <li>**Mickaely (33.33% -> 33.33%):** Manteve o percentual. O importante √© entender onde podemos melhorar para o pr√≥ximo passo.</li>
                            </ul>
                            <p class="mt-2 text-gray-700">A jornada n√£o √© uma linha reta. O importante √© n√£o desistir e buscar apoio.</p>
                        </div>
                    </div>
                </section>
            </div>

            <!-- P√ÅGINA 3: Jornada (Oculta por padr√£o) (INALTERADO) --><div id="page-jornada" class="hidden mt-8">
                <!-- BOT√ÉO VOLTAR (ATUALIZADO) --><button class="btn-voltar mb-4 text-sm font-medium
                               bg-blue-600 text-white hover:bg-blue-700
                               py-2 px-4 rounded-lg shadow-sm transition-colors duration-200">
                    &larr; In√≠cio
                </button>
                <section id="proximos-passos">
                    <!-- T√çTULO SEM N√öMERO --><h2 class="text-2xl font-semibold text-gray-800 border-b-2 border-blue-400 pb-2 mb-4">O Que Levar Desta Jornada</h2>
                     <div class="space-y-4 max-w-4xl mx-auto">
                        <div class="bg-white border border-gray-200 p-6 rounded-lg shadow">
                            <h3 class="font-bold text-lg text-blue-800">Uma Mensagem Final para Voc√™s</h3>
                            <p class="mt-2 text-gray-700">
                                Parab√©ns pela incr√≠vel evolu√ß√£o que voc√™s mostraram! Mais do que os n√∫meros da Prova Paran√°, o que vimos aqui foi a capacidade da turma de focar em um desafio e crescer. Muitos de voc√™s deram saltos impressionantes, saindo do zero e alcan√ßando √≥timos resultados.
                            </p>
                            <p class="mt-4 text-gray-700">
                                Este pode ser o fim do ciclo desta prova, mas a li√ß√£o principal fica: o esfor√ßo de estudar e a dedica√ß√£o para entender um problema (seja em Pensamento Computacional, Hist√≥ria ou Biologia) √© o que constr√≥i o verdadeiro aprendizado.
                            </p>
                             <p class="mt-4 text-gray-700">
                                Levem essa mesma dedica√ß√£o para os pr√≥ximos desafios. Voc√™s provaram que s√£o capazes de evoluir. Parab√©ns a todos pelo ano e pelo esfor√ßo!
                            </p>
                        </div>
                    </div>
                </section>
            </div>

            <!-- P√ÅGINA 4: Evolu√ß√£o Individual (Oculta por padr√£o) (INALTERADO) --><div id="page-evolucao" class="hidden mt-8">
                <!-- BOT√ÉO VOLTAR (ATUALIZADO) --><button class="btn-voltar mb-4 text-sm font-medium
                               bg-blue-600 text-white hover:bg-blue-700
                               py-2 px-4 rounded-lg shadow-sm transition-colors duration-200">
                    &larr; In√≠cio
                </button>
                
                <!-- Layout da p√°gina de evolu√ß√£o: LISTA √öNICA EM ACORDE√ÉO (INALTERADO) --><div class="w-full max-w-4xl mx-auto bg-blue-100 p-6 rounded-lg shadow-lg">
                    
                    <h2 class="text-2xl font-semibold text-blue-900 border-b-2 border-blue-400 pb-2 mb-4">Sua Evolu√ß√£o Individual</h2>
                    
                    <!-- EXPLICA√á√ÉO SUCINTA (Mantida) --><div class="bg-yellow-100 border border-yellow-300 text-yellow-900 p-3 rounded-md mb-4 text-sm">
                        <strong>Como funciona?</strong>
                        <p>√â simples: clique no seu nome na lista abaixo para ver sua jornada em detalhes.</p>
                    </div>

                    <!-- Lista de Alunos (Clic√°vel) - Agora vai conter o acorde√£o --><div id="student-list" class="bg-white rounded-lg shadow-inner border border-gray-200">
                        <!-- Alunos e seus pain√©is de detalhe ser√£o inseridos aqui pelo JavaScript --></div>
                </div>
            </div>

        </main>
    </div>

    <!-- JavaScript para Gr√°ficos e Interatividade --><script>
        // --- 1. DADOS DOS ALUNOS (INALTERADO) ---
        const studentRawData = [
            // P1 e P2 (18 alunos)
            { nome: 'AMANDA', p1: 0.00, p2: 66.67 },
            { nome: 'BRENDA SILVA', p1: 33.33, p2: 66.67 },
            { nome: 'BRUNO', p1: 33.33, p2: 66.67 },
            { nome: 'CARLOS EDUARDO', p1: 66.66, p2: 33.33 },
            { nome: 'JO√ÉO RICARDO', p1: 0.00, p2: 33.33 },
            { nome: 'KARINA', p1: 33.33, p2: 66.67 },
            { nome: 'KAWAN', p1: 33.33, p2: 66.67 },
            { nome: 'LET√çCIA AIKO', p1: 100.00, p2: 66.67 },
            { nome: 'LETICIA', p1: 0.00, p2: 66.67 },
            { nome: 'LUCAS', p1: 33.33, p2: 66.67 },
            { nome: 'LUIS GUSTAVO', p1: 0.00, p2: 66.67 },
            { nome: 'MARIA FERNANDA', p1: 33.33, p2: 66.67 },
            { nome: 'MIGUEL', p1: 0.00, p2: 33.33 },
            { nome: 'MICKAELY', p1: 33.33, p2: 33.33 },
            { nome: 'MILENA', p1: 33.33, p2: 66.67 },
            { nome: 'PEDRO', p1: 0.00, p2: 33.33 },
            { nome: 'SAMUEL', p1: 0.00, p2: 66.67 },
            { nome: 'VITOR HUGO', p1: 0.00, p2: 33.33 },
            
            // Apenas P1 (3 alunos)
            { nome: 'ANDR√â', p1: 33.33, p2: null },
            { nome: 'BREND', p1: 66.66, p2: null },
            { nome: 'MARYANE', p1: 0.00, p2: null },

            // Apenas P2 (2 alunos)
            { nome: 'SARA', p1: null, p2: 66.67 },
            { nome: 'LAYSLA', p1: null, p2: 66.67 }
        ];

        // --- 2. PROCESSAMENTO DOS DADOS (INALTERADO) ---
        const studentData = studentRawData.map(aluno => {
            
            // L√≥gica para NOVOS ALUNOS (p1 √© null)
            if (aluno.p1 === null) {
                return {
                    ...aluno,
                    evolucao: 0,
                    status: 'novo',
                    statusText: 'Nova Aluna',
                    statusColor: 'text-cyan-600',
                    sugestao: `Bem-vinda! Esta foi sua primeira Prova Paran√° registrada. Voc√™ come√ßou com ${aluno.p2.toFixed(2)}% de acertos. √â uma √≥tima base! Continue focada nos estudos.`
                };
            }

            // L√≥gica para ALUNOS QUE SA√çRAM (p2 √© null)
            if (aluno.p2 === null) {
                return {
                    ...aluno,
                    evolucao: 0,
                    status: 'saida',
                    statusText: 'Mudou de Escola',
                    statusColor: 'text-purple-600',
                    sugestao: `Este aluno(a) realizou a 1¬™ Edi√ß√£o da prova e obteve ${aluno.p1.toFixed(2)}% de acertos, mas mudou de escola antes da 2¬™ Edi√ß√£o.`
                };
            }

            // L√≥gica para alunos existentes (P1 e P2)
            const evolucao = aluno.p2 - aluno.p1;
            let status, statusText, statusColor, sugestao;

            if (evolucao > 0) {
                status = 'melhorou';
                statusColor = 'text-green-600';
                if (aluno.p1 === 0 && aluno.p2 > 33.33) {
                    statusText = 'Salto Qu√¢ntico!';
                    sugestao = "UAU! Isso √© o que chamamos de virada de jogo! Sair de 0% e alcan√ßar 66.67% de acertos √© uma conquista incr√≠vel. Parab√©ns pela sua dedica√ß√£o, voc√™ provou que √© capaz de superar qualquer desafio.";
                } else if (aluno.p1 === 0) {
                    statusText = 'Sa√≠da do Zero';
                    sugestao = "Parab√©ns! Voc√™ saiu de 0% de acertos e construiu uma base. Esse √© o primeiro e mais importante passo. Continue assim, e na pr√≥xima prova, vamos trabalhar juntos para alcan√ßar o pr√≥ximo n√≠vel!";
                } else {
                    statusText = 'Evolu√ß√£o S√≥lida';
                    sugestao = "Excelente! Voc√™ dobrou seu percentual de acertos e agora est√° no grupo da frente. Isso mostra consist√™ncia e aprendizado. Mantenha o foco, voc√™ est√° no caminho certo.";
                }
            } else if (evolucao < 0) {
                status = 'queda';
                statusColor = 'text-red-600';
                if (aluno.p1 === 100) {
                    statusText = 'Reflex√£o';
                    sugestao = "Ei, seu 100% de acertos na 1¬™ Edi√ß√£o foi fant√°stico! Voc√™ continuou com uma nota √≥tima (66.67% de acertos). Manter o topo √© sempre um desafio, e talvez a 2¬™ Edi√ß√£o tenha sido mais complexa. Faz parte da jornada. Sua base de conhecimento √© excelente.";
                } else {
                    statusText = 'Reflex√£o';
                    sugestao = `Calma, isso acontece. A jornada de aprender tem altos e baixos. Voc√™ j√° mostrou na 1¬™ Edi√ß√£o que sabe o conte√∫do (${aluno.p1.toFixed(2)}% de acertos). Talvez esse tema novo tenha sido mais complexo ou voc√™ n√£o estava em um bom dia. Estamos aqui para te apoiar. Revise os pontos de dificuldade e vamos recuperar na pr√≥xima!`;
                }
            } else {
                status = 'manteve';
                statusText = 'Consolidou';
                statusColor = 'text-gray-600';
                sugestao = "Voc√™ manteve seu percentual de acertos, o que mostra que consolidou o que j√° sabia. Em uma turma onde 85% avan√ßou, vamos conversar para ver como podemos quebrar essa barreira e crescer juntos na pr√≥xima. Qual foi o ponto mais dif√≠cil para voc√™?";
            }

            return { ...aluno, evolucao, status, statusText, statusColor, sugestao };
        });

        // --- 3. L√ìGICA DOS GR√ÅFICOS (CHART.JS) (INALTERADO) ---
        document.addEventListener('DOMContentLoaded', () => {
            // --- Gr√°fico de Barras (Distribui√ß√£o) ---
            const ctxBar = document.getElementById('distribuicaoChart').getContext('2d');
            
            // Contagem para o gr√°fico de barras
            const p1Counts = { '0%': 0, '33.3%': 0, '66.7%': 0, '100%': 0 };
            const p2Counts = { '0%': 0, '33.3%': 0, '66.7%': 0, '100%': 0 };
            
            studentData.forEach(aluno => {
                // P1 (S√≥ conta quem fez a P1, ou seja, p1 n√£o √© null)
                if (aluno.p1 !== null) {
                    if (aluno.p1 === 0) p1Counts['0%']++;
                    if (aluno.p1 > 0 && aluno.p1 < 34) p1Counts['33.3%']++;
                    if (aluno.p1 > 34 && aluno.p1 < 67) p1Counts['66.7%']++;
                    if (aluno.p1 === 100) p1Counts['100%']++;
                }
                
                // P2 (S√≥ conta quem fez a P2, ou seja, p2 n√£o √© null)
                if (aluno.p2 !== null) {
                    if (aluno.p2 === 0) p2Counts['0%']++;
                    if (aluno.p2 > 0 && aluno.p2 < 34) p2Counts['33.3%']++;
                    if (aluno.p2 > 34 && aluno.p2 < 67) p2Counts['66.7%']++;
                    if (aluno.p2 === 100) p2Counts['100%']++;
                }
            });

            new Chart(ctxBar, {
                type: 'bar',
                data: {
                    labels: ['0%', '33.3%', '66.7%', '100%'],
                    datasets: [
                        {
                            label: 'Prova 1¬™ Edi√ß√£o',
                            data: [p1Counts['0%'], p1Counts['33.3%'], p1Counts['66.7%'], p1Counts['100%']],
                            backgroundColor: 'rgba(59, 130, 246, 0.6)', // Blue
                            borderColor: 'rgba(59, 130, 246, 1)',
                            borderWidth: 1
                        },
                        {
                            label: 'Prova 2¬™ Edi√ß√£o',
                            data: [p2Counts['0%'], p2Counts['33.3%'], p2Counts['66.7%'], p2Counts['100%']],
                            backgroundColor: 'rgba(34, 197, 94, 0.6)', // Green
                            borderColor: 'rgba(34, 197, 94, 1)',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: { display: true, text: 'N¬∫ de Alunos' }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed.y !== null) {
                                        label += context.parsed.y + ' aluno(s)';
                                    }
                                    return label;
                                }
                            }
                        }
                    }
                }
            });

            // --- Gr√°fico de Pizza (Evolu√ß√£o) ---
            const ctxPie = document.getElementById('evolucaoChart').getContext('2d');
            const evolucaoCounts = {
                melhorou: studentData.filter(a => a.status === 'melhorou').length,
                manteve: studentData.filter(a => a.status === 'manteve').length,
                queda: studentData.filter(a => a.status === 'queda').length,
                novos: studentData.filter(a => a.status === 'novo').length,
                saida: studentData.filter(a => a.status === 'saida').length
            };

            new Chart(ctxPie, {
                type: 'pie',
                data: {
                    labels: ['Evolu√≠ram %', 'Consolidou %', 'Tiveram Reflex√£o', 'Novos Alunos', 'Mudaram de Escola'],
                    datasets: [{
                        label: 'Status da Evolu√ß√£o',
                        data: [
                            evolucaoCounts.melhorou, 
                            evolucaoCounts.manteve, 
                            evolucaoCounts.queda, 
                            evolucaoCounts.novos,
                            evolucaoCounts.saida
                        ],
                        backgroundColor: [
                            'rgba(34, 197, 94, 0.7)', // Green
                            'rgba(107, 114, 128, 0.7)', // Gray
                            'rgba(234, 179, 8, 0.7)', // Yellow
                            'rgba(59, 130, 246, 0.7)', // Blue (Novos Alunos)
                            'rgba(126, 34, 206, 0.7)' // Purple (Sa√≠da)
                        ],
                        borderColor: [
                            'rgba(34, 197, 94, 1)',
                            'rgba(107, 114, 128, 1)',
                            'rgba(234, 179, 8, 1)',
                            'rgba(59, 130, 246, 1)',
                            'rgba(126, 34, 206, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        tooltip: {
                             callbacks: {
                                label: function(context) {
                                    let label = context.label || '';
                                    let value = context.parsed;
                                    let total = context.chart.data.datasets[0].data.reduce((a, b) => a + b, 0);
                                    let percentage = ((value / total) * 100).toFixed(1) + '%';
                                    return `${label}: ${value} aluno(s) (${percentage})`;
                                }
                            }
                        }
                    }
                }
            });

            // --- 4. L√ìGICA DA AN√ÅLISE INDIVIDUAL (ACORDE√ÉO COM EMOJIS) ---
            
            const studentListContainer = document.getElementById('student-list');
            let openPanel = null; // Controla qual painel est√° aberto

            studentData
                .sort((a, b) => a.nome.localeCompare(b.nome)) // Ordena por nome
                .forEach(aluno => {
                    
                    // 1. Container para o aluno (Bot√£o + Painel)
                    const studentEntry = document.createElement('div');
                    studentEntry.className = 'border-b border-gray-200';

                    // 2. Bot√£o Clic√°vel (Nome do Aluno)
                    const button = document.createElement('button');
                    button.className = 'w-full text-left p-4 hover:bg-blue-50 transition duration-150 flex justify-between items-center';
                    
                    const nomeSpan = document.createElement('span');
                    nomeSpan.className = 'font-medium text-gray-800 text-lg';
                    nomeSpan.textContent = aluno.nome;
                    
                    const statusSpan = document.createElement('span');
                    statusSpan.className = `text-sm font-semibold ${aluno.statusColor}`;
                    statusSpan.textContent = aluno.statusText;

                    button.appendChild(nomeSpan);
                    button.appendChild(statusSpan);

                    // 3. Painel de Detalhes (Oculto)
                    const detailsPanel = document.createElement('div');
                    detailsPanel.className = 'details-panel'; // Controlado por CSS (max-height)

                    // 4. PREENCHER O PAINEL: Gerar o HTML interno
                    
                    // --- L√≥gica para Barras de Progresso (ATUALIZADA) ---
                    let p1BarHTML = '';
                    if (aluno.p1 === null) {
                        p1BarHTML = `
                            <div>
                                <div class="flex justify-between text-sm font-medium text-gray-600">
                                    <span>Prova 1¬™ Edi√ß√£o (% Acerto)</span>
                                    <span>N/A (N√£o realizou)</span>
                                </div>
                                <div class="w-full progress-bar-bg">
                                    <div class="progress-bar bg-gray-400" style="width: 0%;" data-target-width="0%">N/A</div>
                                </div>
                            </div>`;
                    } else {
                        const p1Text = `${aluno.p1.toFixed(2)}%`;
                        p1BarHTML = `
                            <div>
                                <div class="flex justify-between text-sm font-medium text-gray-600">
                                    <span>Prova 1¬™ Edi√ß√£o (% Acerto)</span>
                                    <span>${p1Text}</span>
                                </div>
                                <div class="w-full progress-bar-bg">
                                    <div class="progress-bar bg-blue-500" style="width: 0%;" data-target-width="${Math.max(aluno.p1, 5)}%">${p1Text}</div>
                                </div>
                            </div>`;
                    }
                    
                    let p2BarHTML = '';
                    if (aluno.p2 === null) {
                        p2BarHTML = `
                            <div>
                                <div class="flex justify-between text-sm font-medium text-gray-600">
                                    <span>Prova 2¬™ Edi√ß√£o (% Acerto)</span>
                                    <span>N/A (Mudou de escola)</span>
                                </div>
                                <div class="w-full progress-bar-bg">
                                    <div class="progress-bar bg-gray-400" style="width: 0%;" data-target-width="0%">N/A</div>
                                </div>
                            </div>`;
                    } else {
                        const p2Text = `${aluno.p2.toFixed(2)}%`;
                        let p2Class = 'bg-gray-500'; // Default
                        if (aluno.status === 'melhorou') p2Class = "bg-green-500";
                        else if (aluno.status === 'queda') p2Class = "bg-yellow-500 text-gray-800";
                        else if (aluno.status === 'novo') p2Class = "bg-cyan-500";

                        p2BarHTML = `
                            <div>
                                <div class="flex justify-between text-sm font-medium text-gray-600">
                                    <span>Prova 2¬™ Edi√ß√£o (% Acerto)</span>
                                    <span>${p2Text}</span>
                                </div>
                                <div class="w-full progress-bar-bg">
                                    <div class="progress-bar ${p2Class}" style="width: 0%;" data-target-width="${Math.max(aluno.p2, 5)}%">${p2Text}</div>
                                </div>
                            </div>`;
                    }

                    // --- L√≥gica para Emojis (INALTERADO) ---
                    let emojiHTML = '';
                    if (aluno.status === 'melhorou') {
                        if (aluno.statusText === 'Salto Qu√¢ntico!') emojiHTML = `<div class="text-6xl my-4">üöÄüåå</div>`;
                        else if (aluno.statusText === 'Sa√≠da do Zero') emojiHTML = `<div class="text-6xl my-4">üìàüå±</div>`;
                        else emojiHTML = `<div class="text-6xl my-4">üéâü§©</div>`;
                    } else if (aluno.status === 'queda') {
                        emojiHTML = `<div class="text-6xl my-4">ü§îüßê</div>`;
                    } else if (aluno.status === 'manteve') {
                        emojiHTML = `<div class="text-6xl my-4">üòêüßò</div>`;
                    } else if (aluno.status === 'novo') {
                        emojiHTML = `<div class="text-6xl my-4">üëãüåü</div>`;
                    } else if (aluno.status === 'saida') {
                        emojiHTML = `<div class="text-6xl my-4">üëãüõ´</div>`;
                    }


                    // --- Montar o innerHTML do Painel (ATUALIZADO com barras) ---
                    detailsPanel.innerHTML = `
                        <div class="p-6">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                
                                <!-- Coluna 1: Gr√°ficos e Mensagem --><div>
                                    <!-- Status com Anima√ß√£o TikTok --><p class="status-text ${aluno.statusColor} text-2xl font-semibold">${aluno.statusText}</p>
                                    
                                    <!-- Barras de Progresso --><div class="mt-6 space-y-4">
                                        ${p1BarHTML}
                                        ${p2BarHTML}
                                    </div>

                                    <!-- Mensagem --><div class="mt-8">
                                        <p class="font-semibold text-blue-800 text-lg">Uma mensagem para voc√™:</p>
                                        <blockquote class="border-l-4 border-blue-300 pl-4 italic text-gray-700 mt-2 text-base">
                                            ${aluno.sugestao}
                                        </blockquote>
                                    </div>
                                </div>

                                <!-- Coluna 2: Emojis e Bot√£o (INALTERADO) --><div class="flex flex-col justify-between items-center text-center p-4 bg-white rounded-lg shadow-inner min-h-[250px]">
                                    
                                    <!-- EMOJIS (NOVO) -->${emojiHTML}
                                    
                                    <a href="https://forms.gle/SSSYWgGuoNdL3UQT8" target="_blank" rel="noopener noreferrer" class="inline-block bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-8 rounded-lg transition-colors duration-200 shadow-md text-lg">
                                        Deixar minha Reflex√£o
                                    </a>
                                </div>
                            </div>
                        </div>
                    `;

                    // 5. Evento de Clique (Toggle Acorde√£o) (ATUALIZADO)
                    button.onclick = () => {
                        // Se um painel j√° estiver aberto E n√£o for este, feche-o
                        if (openPanel && openPanel !== detailsPanel) {
                            openPanel.classList.remove('open');
                            openPanel.previousElementSibling.classList.remove('bg-blue-100', 'border-l-4', 'border-blue-500');
                            
                            // Reseta as barras do painel antigo (ATUALIZADO)
                            openPanel.querySelectorAll('.progress-bar').forEach(bar => {
                                bar.style.width = '0%';
                            });
                        }

                        // Abre ou fecha o painel atual
                        detailsPanel.classList.toggle('open');
                        
                        if (detailsPanel.classList.contains('open')) {
                            // Marca este como o painel aberto
                            openPanel = detailsPanel;
                            button.classList.add('bg-blue-100', 'border-l-4', 'border-blue-500');
                            
                            // Reinicia as anima√ß√µes dentro do painel
                            const pulseAnim = detailsPanel.querySelector('.status-text');
                            
                            if (pulseAnim) {
                                pulseAnim.classList.remove('animate-pulseZoom');
                                void pulseAnim.offsetWidth;
                                pulseAnim.classList.add('animate-pulseZoom');
                            }

                            // ATIVA A ANIMA√á√ÉO DAS BARRAS (NOVO)
                            // Usamos um pequeno timeout para garantir que o CSS 'transition' pegue a mudan√ßa de '0%' para 'target-width'
                            setTimeout(() => {
                                const bars = detailsPanel.querySelectorAll('.progress-bar');
                                bars.forEach(bar => {
                                    bar.style.width = bar.dataset.targetWidth;
                                });
                            }, 100); // 100ms de delay para a anima√ß√£o da barra

                        } else {
                            // Se foi fechado, n√£o h√° painel aberto
                            openPanel = null;
                            button.classList.remove('bg-blue-100', 'border-l-4', 'border-blue-500');
                            
                            // Reseta as barras (ATUALIZADO)
                            detailsPanel.querySelectorAll('.progress-bar').forEach(bar => {
                                bar.style.width = '0%';
                            });
                        }
                    };

                    // 6. Adicionar o bot√£o e o painel ao container do aluno
                    studentEntry.appendChild(button);
                    studentEntry.appendChild(detailsPanel);

                    // 7. Adicionar o container do aluno √† lista
                    studentListContainer.appendChild(studentEntry);
                });

            // --- 5. L√ìGICA DE NAVEGA√á√ÉO DAS P√ÅGINAS (INALTERADO) ---
            const pageHome = document.getElementById('page-home');
            const pageConquistas = document.getElementById('page-conquistas');
            const pageJornada = document.getElementById('page-jornada');
            const pageEvolucao = document.getElementById('page-evolucao');
            const allPages = [pageHome, pageConquistas, pageJornada, pageEvolucao];

            const btnConquistas = document.getElementById('btn-conquistas');
            const btnJornada = document.getElementById('btn-jornada');
            const btnEvolucao = document.getElementById('btn-evolucao');
            const btnVoltar = document.querySelectorAll('.btn-voltar');

            // Fun√ß√£o para mostrar uma p√°gina e esconder as outras
            function showPage(pageToShow) {
                allPages.forEach(page => {
                    if (page === pageToShow) {
                        page.classList.remove('hidden');
                    } else {
                        page.classList.add('hidden');
                    }
                });
                window.scrollTo(0, 0); // Rola para o topo
            }

            // Eventos dos bot√µes de navega√ß√£o
            btnConquistas.onclick = () => showPage(pageConquistas);
            btnJornada.onclick = () => showPage(pageJornada);
            btnEvolucao.onclick = () => showPage(pageEvolucao);

            // Eventos dos bot√µes "Voltar"
            btnVoltar.forEach(button => {
                button.onclick = () => showPage(pageHome);
            });

        });
    </script>

</body>
</html>
